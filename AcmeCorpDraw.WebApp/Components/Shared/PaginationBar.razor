<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center align-bottom">
        <li class="page-item @(CurrentPage <= 1 ? "disabled" : "")">
            <button class="page-link"
                    @onclick="() => ChangePage(CurrentPage - 1)"
                    disabled="@(CurrentPage <= 1)">
                Previous
            </button>
        </li>

        @if (startPage > 1)
        {
            <li class="page-item">
                <button class="page-link" @onclick="() => ChangePage(1)">1</button>
            </li>
            @if (startPage > 2)
            {
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            }
        }

        @for (int i = startPage; i <= endPage; i++)
        {
            int pageNumber = i;
            <li class="page-item @(CurrentPage == pageNumber ? "active" : "")">
                <button class="page-link" @onclick="() => ChangePage(pageNumber)">
                    @pageNumber
                </button>
            </li>
        }

        @if (endPage < PageAmount)
        {
            @if (endPage < PageAmount - 1)
            {
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            }
            <li class="page-item">
                <button class="page-link" @onclick="() => ChangePage(PageAmount)">@PageAmount</button>
            </li>
        }

        <li class="page-item @(CurrentPage >= PageAmount ? "disabled" : "")">
            <button class="page-link"
                    @onclick="() => ChangePage(CurrentPage + 1)"
                    disabled="@(CurrentPage >= PageAmount)">
                Next
            </button>
        </li>
    </ul>
</nav>

@code {
    [Parameter]
    public int PageAmount { get; set; }

    [Parameter]
    public int CurrentPage { get; set; }

    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }

    private int maxPagesToShow = 5;
    private int startPage;
    private int endPage;

    protected override void OnParametersSet()
    {
        CalculatePageRange();
    }

    private void CalculatePageRange()
    {
        if (PageAmount <= maxPagesToShow)
        {
            startPage = 1;
            endPage = PageAmount;
        }
        else
        {
            int halfRange = maxPagesToShow / 2;

            if (CurrentPage <= halfRange + 1)
            {
                startPage = 1;
                endPage = maxPagesToShow;
            }
            else if (CurrentPage >= PageAmount - halfRange)
            {
                startPage = PageAmount - maxPagesToShow + 1;
                endPage = PageAmount;
            }
            else
            {
                startPage = CurrentPage - halfRange;
                endPage = CurrentPage + halfRange;
            }
        }
    }

    private async Task ChangePage(int newPage)
    {
        if (newPage >= 1 && newPage <= PageAmount && newPage != CurrentPage)
        {
            await OnPageChanged.InvokeAsync(newPage);
        }
    }
}